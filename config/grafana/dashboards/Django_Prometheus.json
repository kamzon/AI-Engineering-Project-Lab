{
  "title": "Django + Prometheus",
  "editable": true,
  "schemaVersion": 38,
  "version": 3,
  "time": { "from": "now-6h", "to": "now" },
  "panels": [
    {
      "type": "timeseries",
      "title": "HTTP Responses (by status)",
      "gridPos": { "h": 6, "w": 24, "x": 0, "y": 0 },
      "targets": [
        {
          "expr": "sum by (status) (rate(django_http_responses_total_by_status_total[5m]))",
          "legendFormat": "{{status}}",
          "refId": "A"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Request Duration p90 (seconds)",
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 6 },
      "targets": [
        {
          "expr": "histogram_quantile(0.90, sum by (le) (rate(django_http_requests_latency_including_middlewares_seconds_bucket[5m])))",
          "legendFormat": "p90",
          "refId": "B"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "HTTP Requests per second (by method)",
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 6 },
      "targets": [
        {
          "expr": "sum by (method) (rate(django_http_requests_total_by_method_total[5m]))",
          "legendFormat": "{{method}}",
          "refId": "C"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Pipeline stage timings (s)",
      "gridPos": { "h": 7, "w": 24, "x": 0, "y": 12 },
      "targets": [
        {
          "expr": "sum by (stage) (rate(pipeline_inference_seconds_sum[5m])) / sum by (stage) (rate(pipeline_inference_seconds_count[5m]))",
          "legendFormat": "{{stage}}",
          "refId": "D"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Count API response time (s)",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 19 },
      "targets": [
        {
          "expr": "sum by (object_type) (rate(api_count_response_seconds_sum[5m])) / sum by (object_type) (rate(api_count_response_seconds_count[5m]))",
          "legendFormat": "{{object_type}}",
          "refId": "E"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Pipeline API response time (s)",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 19 },
      "targets": [
        {
          "expr": "sum by (object_type) (rate(pipeline_api_response_seconds_sum[5m])) / sum by (object_type) (rate(pipeline_api_response_seconds_count[5m]))",
          "legendFormat": "{{object_type}}",
          "refId": "F"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Classifier confidence (by label)",
      "gridPos": { "h": 7, "w": 12, "x": 0, "y": 26 },
      "targets": [
        {
          "expr": "sum by (label) (rate(classifier_confidence_sum[5m])) / sum by (label) (rate(classifier_confidence_count[5m]))",
          "legendFormat": "{{label}}",
          "refId": "G"
        }
      ]
    },
    {
      "type": "stat",
      "title": "Min confidence per label (latest)",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 26 },
      "targets": [
        {
          "expr": "pipeline_model_min_confidence",
          "legendFormat": "{{label}}",
          "refId": "H"
        }
      ],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false } }
    },
    {
      "type": "timeseries",
      "title": "Precision / Recall / Accuracy",
      "gridPos": { "h": 7, "w": 24, "x": 0, "y": 33 },
      "targets": [
        { "expr": "sum by (object_type) (pipeline_count_precision_sum) / clamp_min(sum by (object_type) (pipeline_count_precision_count), 1)", "legendFormat": "precision {{object_type}}", "refId": "I" },
        { "expr": "sum by (object_type) (pipeline_count_recall_sum) / clamp_min(sum by (object_type) (pipeline_count_recall_count), 1)", "legendFormat": "recall {{object_type}}", "refId": "J" },
        { "expr": "sum by (object_type) (pipeline_count_accuracy_sum) / clamp_min(sum by (object_type) (pipeline_count_accuracy_count), 1)", "legendFormat": "accuracy {{object_type}}", "refId": "K" }
      ]
    }
  ]
}
